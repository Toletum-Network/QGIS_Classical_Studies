# Dados geoespaciais recolha e curadoria

[Regresso à primeira aula](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/1.%20Introdu%C3%A7%C3%A3o_EN.md#introdu%C3%A7%C3%A3o-primeiro-mapa)

The class we will start collecting our own data from scratch. Where do we find data? How should we organise our data to fit it our spatial questions?

In preparation for the next meeting you need to work through the manual and prepare all the data. The session will go into the issues and challenges you have found. 

[Download the execise data here](https://github.com/Toletum-Network/QGIS_Classical_Studies/tree/8d907fef09120267eefcf3e094dfca29f43b60d1/M%C3%A9todos_espaciais_para_os_visigodos/Data)

## Plano de aula

| **Hora**         |   **Tema**   |
|:--------------|:-----------|
| 9.00 - 9.15 | Perguntas |
| 9.15 - 9.45 | [Dados espaciais](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/2.%20Dados_geoespaciais_recolha_e_curadoria.md#21-dados-espaciais)  |
| 9.45 - 10.30 | [Curadoria de dados](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/2.%20Dados_geoespaciais_recolha_e_curadoria.md#22-digitaliza%C3%A7%C3%A3o-de-dados)|
| 10.30 - 10.45 | **Pausa** | 
| 10.45 - 11.30 | [Digitalização de dados](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/2.%20Dados_geoespaciais_recolha_e_curadoria.md#23-tratamento-de-dados) |
| 11.30 - 12.00 | Perguntas |

## 2.1 Dados espaciais
In the last session you were handed some data and asked to create a map. However, in may cases you won't find data being delivered so easily.
Luckily there are some places where we can find geospatial data for Antiquity. The [Mercury project](https://projectmercury.eu/datasets/) is one of these very helpful sites where different datasets are aggregated.

Now it is great to find usable data. However, we should not lose ourselves in a data collection frenzy. Just like we don't go into the library and randomly start reading books, we need to ask ourselves what data we need for our research questions. Moreover, we might encounter spatial data in a multitude of forms and want to use it for your research questions. Here we are on the intersection of our knowledge as historians, where source critisism is central, and spatial data. As historians we are used to consider our sources for their context and decide what we can use and what to discard. Often we need to do the same with spatial data.


### 2.1.1 Valor separado por vírgula o CSV
A very easy and basic way to collect and organise our spatial data is Excel. Similar to the Attribute Table of our files in QGIS we have, fields (colums) and rows (lines). The benefit of Excel is that we can work with a rather easy programme to start organizing our data and we can convert it to a format that can be read by QGIS: the CSV. 

The CSV, in portuguese Valor separado por vírgula, is a text file format that saves tabular data. The delimiter of te data is the comma, hence the name. It is good practice to avoid comma's in your attributes, to avoid problems when converting to CSV. All mark-up you use in Excel will be lost when saving it as a CSV. So the fancy coloring and filtering is lost in the CSV. 

However, let us start with taking a look at the Excel sheet that was the basis for our earlier Places. Take a look at the excel sheet _**Places_Visigothic_Councils_list**_ in the data package for this class. Here we have all people mentioned from the Third Council of Toletum (589) up to the Sixteenth (693). For good practice the first field 'Código' contains an ID number for each entry. The choice to make this numerical in ascending order per council is very helpful. It is followed by 'Concílio' and 'Ano', both indicating the council by number and year. Then we have the 'Cargo (latím)' or position of the person followed by the place as 'Sede' and 'Sede (latím)'.

In our life we will find many of these lists in publications. They are spatial as they contain places. However, often people don't see the need, or don't know how, to convert this into a map. Therefore, they opt for a list without the needed spatial data (the Y and X colums, where we need to put the coordinates). But, how do we find the coordinates of these places?

As you might notice there are some places that have a PLeiades code. This code refers to the [Pleiades](https://pleiades.stoa.org/) dataset. Here you can search most ancient places. We can search by ancient or modern name. Note that spelling is important, but partial names also gives results. So best to write the bare minimum in order to find your result.

If we search Acci, or for its number 265765, we see the following info page:

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/dc243782-3ff3-4f2e-b9b8-2d037c59e54e)

The coordinates in Pleiades are given in [Decimal Degrees](https://en.wikipedia.org/wiki/Decimal_degrees). This Geometry definition is the most usefull as it works for the whole world. This in contrast to a [UTM](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system) that is only valid within one UTM zone, for instance UTM 30N for Spain. Moreover, the DD system is rather simple in contrast to the Sexagesimal [DMS](https://en.wikipedia.org/wiki/Degree_(angle)#Subdivisions) which is the famous degrees minutes seconds notation: 41°39′0″ N, 0°53′0″ W. The notation of DMS is prone to typos and mistakes. 

Knowing these different systems is of importance for the next way to locate coordinates. The forbidden source of information, Wikipedia. When we take for example 'Villanueva de la Fuente', we find no result in Pleiades, but Wikipedia gives us a result:

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/25877ef2-9702-4769-a461-da87e7f40b5a)

On the top right corner we find the DMS coordinates. When we click these we go to the GeoHack page with more coordinate systems and links to online maps:  

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/cf9a3a60-37d2-42ae-bd1c-94f57d3e5c78)

Here we can copy the Decimal Degrees notation. Note the degree sign ° behind the DD notation, make sure you leave this out as it is not needed.

#### 2.1.1.1 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Locating places
Our list of councils has a total of 81 sees. We want to find the coordinates. As a practice search and find at least ten places using the methods described above.


#### 2.1.1.2 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Minting data

When we start working with data we have to decide what our spatial unit is going to be. In our case we have opted for the places from which the bishops come to the Councils of Toletum. Of course there are other ways to organise our data. 

Read the article by Dr. Pliego on the Visigothic coins in the datapackage: _Pliego (2012) La Moneda Visigoda Anexo I_. So since the publication of her books on Visigothic coinage in 2009 there are some additions and changes. The article holds an annex (p. 217) with places and coins. Since we have places we have spatial data! We can enter and use this.

In the Data package for this session you find another excel file: _Places_Visigothic_councils_curated_. It looks quite complicated and there is quite a lot of information. For now you can ignore this, we will look at these later in the section on [Data curation](). At the end of the many fields, or rows, you see a column minting. Here we want to enter our data. 

Think about what you want to enter. The excercise is not just to enter data from a publication into an excel. It is also about deciding what data is useful and how to enter it. 

Now we have a nice excel sheet with data. But what to do with this? First we need to save it as a CSV.

### 2.1.2 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Adding a Delimited Text layer
We can upload the CSV via the **``Data Source Manager``** dialog allows you to choose the data to load depending on the data type. We’ll use it to load our datast on Emerita Augusta in Late Antiquity. This data has been collected within the [ATLAS-project](www.atlas-cities.com) and is mostly based on the [CILAE](https://cil2digital.web.uah.es/) database.

Click the ![Data Source Manager](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/Open%20Data%20Source%20Manager.png) **``Open Data Source Manager``** button. Select the ![image](https://user-images.githubusercontent.com/66669249/175493332-d80bc172-3e4e-4031-800f-6761694af71e.png) Delimited text tab and click the **``...``** to open the directory. Locate the CSV ``Emerita_epigraphie``. 

![image](https://user-images.githubusercontent.com/66669249/175494217-8bc04792-0941-4846-9543-a557b7da2405.png)

As CSV or Delimited text files can be very different we have to check our data before uploading it. The **``Data Source Manager``** gives us a multitude of options to tweak how we enter our CSV. Let's have a look at it from top to bottom ([More info on QGIS page](https://docs.qgis.org/3.22/en/docs/user_manual/managing_data_source/opening_data.html#geometry-definition)).

First we have our``File name`` with the directory. Followed by the ``Layer name``, in this case ``Emerita_epigraphie``. And the ``Encoding`` of our file. Note that this is an important field to check. Often this is set on ``UTF-8`` or ``Latin-9``. At the bottom of the screen we see our **``Sample data``**. Before importing the data it is good to keep an eye on the changes here. If we find unexpected or strange signs in our attribute values, then we need to change the ``Encoding``.

Next we turn to **``File Formart``**. Here we select the way our data is constrcuted. When we open the csv in excel we can see the delimiter. In our case it is a semi-colon ``;``, so we have to select **``Custom delimiters``** and select _Semicolon_. 

**``! Note``** <br>
When working with a Delimited text it is important to decide on the delimiter and NEVER use this delimiter in your attribute values. This way we avoid problems woith uploading our data. In the case you are working with data obtained from others (without a good practice of delimiters) we can select multiple delimiters in the "Custom delimiters".

The **``Record and Field Options``** allows us to discard rows under ``Number of header lines to discard``. And indicate the Header of the colums with the ``First record has field names``.

**``Geometry Definition``** handles our spatial information. When working with our epigraphy in a sheet we have to collect the spatial data. This can be done in different formats (here given for Zaragoza):
* Sexagesimal [DMS](https://en.wikipedia.org/wiki/Degree_(angle)#Subdivisions): 41°39′0″ N, 0°53′0″ W
* [Decimal Degrees](https://en.wikipedia.org/wiki/Decimal_degrees): 41.65, -0.883333 (note that we find them with ° as well, this has to be deleted)
* [UTM](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system): 4613082 676259 30T (UTM needs the Zone, in this case 30T)

As the **DMS** and **UTM** can easily lead to mistakes (or typos) it is best to use the **DD** (Decimal Degrees) format. We label our fields X/Y or Longitude/Latitude. 
Then we select our ``Geometry CRS`` using the ![image](https://user-images.githubusercontent.com/66669249/175505355-8a54a79b-64ae-45dd-ba94-ffe4dcdc73da.png). We can alwas change the CRS later in our ``Layers panel``. For our data we use the ``CRS`` **EPSG: 4326 - WGS 84**.
 
Click **``Add``**, you can check the data in the project and if it is good, then click **``Close``**. 

Now we have added the CSV to our project. We can manipulate the symbology in the same manner as the shapefiles we have been doing before. The downside of the Delimited text layer is that we cannot edit it within QGIS. You will notice that the ![image](https://user-images.githubusercontent.com/66669249/175506009-b40aa1ef-3cbe-4801-967d-ef3150aa019c.png) ``Edit`` icon is grey. If we want to edit the attribute values we need to do this in the CSV and then save the CSV file. After hitting the ![image](https://user-images.githubusercontent.com/66669249/175506680-3bc64ce5-2c65-44f3-bdcd-22755cb9ea0d.png) ``Refresh`` button we will see the changes in QGIS.

**``! Note``**<br>
If you work with a CSV in QGIS and need to change anything else than attribute values (e.g. the name of the file, directory of the file, the names of columns or the number of columns), you will need to add the layer again.

#### I.3.4.2 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Delimited text to Shapefile
If we want to work with the data as Vector data in shapefile format we can save it as a ESRI Shapefile. Richt click the layer in the layer panel. Then **``Export ‣ Save Features As...``** and the "Save Vector Layer As..." panel opens. 
It should have ESRI Shapefile as default format. Choose the directory under File Name via ``...``, select the preferred folder.
Leave all other field to default. make sure the box "Add saved file to map" is checked and hit ``OK``. 

For more info on editing Vector data see [Module 6](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/Training_Manual/6.%20Module:%20Creating%20Vector%20Data.md#6-module-creating-vector-data).


## 2.2 Digitalização de dados
Data delivered in different formats


In some cases we want to obtain data from existing maps. For this we can use the georeferencer --> raster and vector data. 
We will work with a raster file or just plainly an image. In the data package for this session you find the map with the "Germanic Kingdoms". As we are interested in this period we might want to digitize the boundaries of the Suebic and Visigothic kingdoms: _**Die Germanische Nachfolgestaate Westroms (NPAtlas)**_. This map is part of the [Der Neue Pauly Supplemente I Online - Band 3: Historischer Atlas der antiken Welt](https://referenceworks.brillonline.com/browse/der-neue-pauly-supplemente-i-3). As scholars of the Visigothic period we might not fully agree with the extends of the boundaries, but that is for later worry. Let us first start with the digitization of the map as it is.

However, before we start we need to ask ourselves a few questions: 
* _Why am I digitizing the image?_ As stated before, don't create spatial data just because you can. Do you really need it?
* _Is there a way to obtain the data directly from the original source?_ This is an important question. Although it is often easier to just digitize the data directly from a georeferenced image, it is seldomly the best solution. <br>
First, georeferencing an image distorts the image as it will be warped to fit the projection you are using. If you are lucky the image is on the same projection you are using AND it has not been reshaped by editors. The latter is the worst, often editors of publications just so slightly change the width or heigth of an image to make it fit the page better. Thereby the geospatial relations are completely off. <br>
Second, and more importantly, eventhough it is a map the information might n


### 2.2.1 Georeferencing images



Now you have succesfully added the image to your QGIS project! But it is still not the data in the way you want it.

### 2.2.2 Drawing vector from raster
It is time to create your vector data from this map. Remember we have three types of data:
1. Point data
2. Line data
3. Polygon data
It is clear that our boundaries are not going to be point data. Nonetheless, we have to decide whether we want to add the boundaries as plygon data, the way they are being presented in the image, or as line data. Both have (dis)advantages.

We will create polygon data as we want to color the area controlled by the kingdoms (remember polygon data has an area, line data doesn't). 



### 2.2.1 Adding an Openmap service
To be able to georeference our image we need a good base 
<br> adding a open layer for reference


## 2.3 Curadoria de dados
Returning to the excel sheet _**Places_Visigothic_Councils_list**_ with which we started earlier. While working with the places data you might have noticed some colored cells. These are problematic cells where we find conflicting data. For instance, the first red cell is ID 14, where the Sede is called Granada. The reason to label might not be clear at first sight. Granada is the site of the Roman city of Iliberris. However, when we look at other attestations of Iliberris we find that it is linked to Elvira. We as researchers have to find out why this descrepancy is in our list and how to solve this.

Compare the two excel sheets we have in the data package.

Data cleaning, ordering
Drop site for non geospatial data

Certainties


[Passar para a aula seguinte](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/3.%20An%C3%A1lises_de_datos_relacional_e_quantitativa.md)
