# Recolha de dados geoespaciais

[Regresso à primeira aula](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/1.%20Introdu%C3%A7%C3%A3o_PT.md#introdu%C3%A7%C3%A3o-primeiro-mapa)

Nesta aula, começaremos a coletar nossos próprios dados do zero. Onde encontramos dados? Como devemos organizar nossos dados para ajustá-los às nossas questões espaciais?

Na preparação para a próxima reunião, será necessário ler as instruções e preparar todos os dados. A sessão abordará os problemas e desafios que você encontrou. 

[Download the execise data here](https://github.com/Toletum-Network/QGIS_Classical_Studies/tree/master/M%C3%A9todos_espaciais_para_os_visigodos/Data)

## Plano de aula

| **Hora**         |   **Tema**   |
|:--------------|:-----------|
| 9.00 - 9.45 | Perguntas primeira aula |
| 9.45 - 10.30 | [Dados espaciais](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/2.%20Dados_geoespaciais_recolha_e_curadoria.md#21-dados-espaciais)  |
| 10.30 - 10.45 | **Pausa**|
| 10.45 - 11.30 | [Digitalização de dados](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/2.%20Dados_geoespaciais_recolha_e_curadoria.md#22-digitaliza%C3%A7%C3%A3o-de-dados) | 
| 11.30 - 12.00 | Perguntas |

## 2.1 Dados espaciais
Na última sessão você recebeu alguns dados e pedimos que criasse um mapa. No entanto, em alguns casos, os dados não serão disponibilizados com essa facilidade. Felizmente, existem alguns lugares onde podemos encontrar dados geoespaciais sobre a Antiguidade. O projeto [Mercury](https://projectmercury.eu/datasets/) é um desses sites muito úteis onde diferentes conjuntos de dados são agregados.

É ótimo encontrar dados utilizáveis, mas não devemos nos perder em um frenesi de recolha de dados. Assim como não vamos à biblioteca e começamos a ler livros aleatoriamente, precisamos nos perguntar quais dados precisamos para nossas questões de pesquisa. Além disso, podemos encontrar dados espaciais em diversas formas e querer usá-los para nossas questões de pesquisa. Aqui estamos na intersecção do nosso conhecimento como historiadores, onde a crítica das fontes é central, e os dados espaciais. Como historiadores, estamos acostumados a considerar nossas fontes de acordo com seu contexto e decidir o que podemos usar e o que descartar. Muitas vezes precisamos fazer o mesmo com dados espaciais.


### 2.1.1 Valor separado por vírgula o CSV
Uma maneira muito fácil e básica de coletar e organizar nossos dados espaciais é o Excel. Semelhante à Tabela de Atributos dos nossos shapefiles no QGIS, temos dados tabulares, ou seja, temos campos (colunas) e fileiras (linhas). A vantagem do Excel é que podemos trabalhar com um procedimento bastante fácil para começar a organizar nossos dados e podemos convertê-los para um formato que possa ser lido pelo QGIS: o CSV.

O CSV, em português “valor separado por vírgula”, é um formato de arquivo de texto que salva dados tabulares. O delimitador dos dados é a vírgula, daí o nome. É uma boa prática evitar vírgulas em seus atributos, para evitar problemas na conversão para CSV. Todas as marcações usadas no Excel serão perdidas ao salvá-las como CSV. Portanto, cores e filtros sofisticados são perdidas no CSV.

No entanto, vamos começar dando uma olhada na planilha Excel que serviu de base para nosso _**Visigoths_Places.shp**_ anterior. Dê uma olhada na planilha Excel _**Places_Visigothic_Councils_curated**_ no pacote de dados desta classe.

Parece bastante complicado e há muita informação. Por enquanto você pode ignorar isso, o que veremos mais tarde na seção sobre [Curadoria de dados](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/3.%20An%C3%A1lises_de_datos_EN.md#31-curadoria-de-dados). No final de muitos campos ou linhas, você vê uma coluna “cunhagem” (“minting”). É aqui que queremos inserir novos dados.


#### 2.1.1.1 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Dados do cunhagem
Leia o artigo da Dra. Pliego sobre as moedas visigodas no pacote de dados: _Pliego (2012) La Moneda Visigoda Anexo I_. Desde a publicação de seus livros sobre cunhagem visigoda em 2009, ocorreram alguns acréscimos e alterações. O artigo contém um anexo (p. 217) com lugares e moedas. Como temos lugares, temos dados espaciais! É isso que usaremos.

Pense no que você deseja inserir. O exercício não consiste apenas em inserir dados de uma publicação em um Excel. Trata-se também de decidir quais dados são úteis e como inseri-los. Se você acredita que precisa de mais colunas para inserir dados, você pode adicioná-las à direita apenas inserindo os dados. O Excel expandirá automaticamente a tabela.

**`! Nota`**
Não há certo ou errado, desde que você possa explicar por que está coletando os dados.

Com `crtl + F` (ou `crtl + L`) você pode pesquisar nomes de lugares no Excel. Pode ser necessário adicionar um novo nome de lugar.

#### 2.1.1.2 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Localização de lugares
Embora a nossa lista de lugares seja bastante longa, rapidamente encontramos alguns que não conseguimos localizar facilmente. O primeiro caso é _Narbona_. Como localizamos _Narbona_ e inserimos suas coordenadas?

Como você pode notar, a maioria dos lugares tem um código _Pleiades_. Este código refere-se ao banco de dados [Pleiades](https://pleiades.stoa.org/) (e sim, você também pode baixar o conjunto completo na aba [Downloads](https://pleiades.stoa.org/downloads)). Aqui você pode pesquisar a maior parte dos lugares antigos. Podemos pesquisar por nome antigo ou moderno. Observe que a ortografia é importante, mas os nomes parciais também fornecem resultados. Portanto, é melhor escrever o mínimo para encontrar o resultado.

Se pesquisarmos Narbo, obteremos vários resultados:

* **Narbonne, Narbon** = [246347](https://pleiades.stoa.org/places/246347) Col. Narbo Martius <br>
Col. Narbo Martius (modern Narbonne) was established in Gaul in 118 B.C. as a Roman colony.
* **Narbon** = [246199](https://pleiades.stoa.org/places/246199) Atax (river)<br>
The Aude river.
* **Narbonensis II** = [992827](https://pleiades.stoa.org/places/992827)<br>
An ancient place, cited: BAtlas 101 H3 no. 1 (Narbonensis II)
* **Narbonensis I** = [991333](https://pleiades.stoa.org/places/991333)<br>
An ancient place, cited: BAtlas 101 G3 Narbonensis I
* **Narbonensis, Narbonensis (province)** = [981537](https://pleiades.stoa.org/places/981537)<br>
The Roman imperial province of Gallia Narbonensis.
* **Narbonensis, Narbonensis (region)** = [148141](https://pleiades.stoa.org/places/148141)<br>
An ancient place, cited: BAtlas 15 C2 Narbonensis

Sem qualquer conhecimento dos locais e regiões aqui mencionados podemos facilmente nos perder. Procuramos o lugar Narbona, que se chamava **Narbo Martius**. Então clicamos no link do número Pleiades [246347](https://pleiades.stoa.org/places/246347).

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/fe36f6e7-3344-45a2-93d4-97216e6313ce)

As coordenadas no Pleiades são dadas em graus decimais, [Decimal Degrees](https://en.wikipedia.org/wiki/Decimal_degrees), ou DD. Esta definição de Geometria é a mais útil porque funciona para todo o mundo. Isto contrasta com um [UTM](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system), que só é válido dentro de uma zona UTM, por exemplo UTM 30N para Espanha. Note que Narbonne estaria em 31T! Além disso, o sistema DD é bastante simples em contraste com o Sexagesimal [DMS](https://en.wikipedia.org/wiki/Degree_(angle)#Subdivisions), que é a famosa notação de graus minutos segundos: 43°11′0″ N, 3°0′0″ W. A notação de DMS é propensa a erros de digitação e outros tipos.

Conhecer esses diferentes sistemas é importante para a próxima forma de localizar coordenadas. Nosso próximo desafio é encontrar _Cepis_. O lugar não está localizado com certeza. No entanto, seguiremos a Dra. Pliego e o localizaremos em _Castelões de Cepeda_. Infelizmente, não encontramos nenhum resultado no Pleiades. No entanto, a fonte de informação proibida, a Wikipédia, nos dá um resultado para [_Castelões de Cepeda_](https://pt.wikipedia.org/wiki/Castel%C3%B5es_de_Cepeda).

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/2b9413ca-cc80-48a7-94c0-0b062f969130)

Para a maioria dos lugares, a Wikipedia fornece coordenadas. Eles podem ser encontrados no canto superior direito da página ou na coluna lateral com informações sobre o local. Ao clicar nestas coordenadas, somos levados à página [GeoHack de _Castelões de Cepeda_](https://geohack.toolforge.org/geohack.php?language=es&pagename=Castel%C3%B5es_de_Cepeda&params=41.200833333333_N_-8.3305555555556_E_type:city). Aqui encontramos as diferentes notações da Geometria:

* DMS 41° 12′ 3″ N, 8° 19′ 50″ W
* Decimal 41.200833, -8.330556
* Geo URI	geo:41.200833,-8.330556
* UTM	29T 556130 4561268

Aqui podemos copiar a notação de Graus Decimais. Observe que às vezes encontramos o sinal de grau `°` atrás da notação DD. Certifique-se de deletar isso, pois não é necessário. 

_Vada_ cria um problema: sua localização é desconhecida. Faremos a inclusão sem coordenadas. _Elbora_ parece ser um erro de digitação e deveria ser _Elvora_. Note-se que a associação de _Elvora_ com _Talavera la Reina_ é contestada. Mesmo assim, seguimos a Dra. Pliego.

Agora temos uma bela planilha Excel com dados. Mas o que fazer com isso? Primeiro, precisamos salvá-la como CSV. Você pode fazer isso em "Salvar como..." (ou "Save as...") e selecionar a opção CSV:

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/4abcafa7-0a3e-4688-aee7-56bbe9d6f89e)

(Ignore o alemão ;-) 

Para uma boa prática, renomeamos o arquivo para que reflita as alterações que fizemos:  _**Places_Visigothic_Councils_minting**_
Depois de salvar o CSV em uma pasta adequada, da qual lembraremos mais tarde, podemos começar a adicionar isso ao nosso projeto. Abra seu projeto.

**`! Nota`**
Estes dados de cunhagem estão muito incompletos. Para nosso exercício, coletamos apenas os dados do artigo anexo. Para criar uma lista completa, precisaríamos adicionar também os dados de Pliego 2009 e procurar possíveis novas descobertas entre 2012 e 2023!

### 2.1.2 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Adicionando uma camada de texto delimitado
We can upload our CSV via the **``Data Source Manager``** dialog allows you to choose the data to load depending on the data type. We’ll use it to load our datast with minting. 

Click the ![Data Source Manager](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/Open%20Data%20Source%20Manager.png) **``Open Data Source Manager``** button. Select the ![image](https://user-images.githubusercontent.com/66669249/175493332-d80bc172-3e4e-4031-800f-6761694af71e.png) Delimited text tab and click the **``...``** to open the directory. Locate the CSV  _**Places_Visigothic_Councils_minting**_. 

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/9b5868d1-8e3d-47dd-a925-c0020aa2ba4b)


As CSV or Delimited text files can be very different we have to check our data before uploading it. The **``Data Source Manager``** gives us a multitude of options to tweak how we enter our CSV. Let's have a look at it from top to bottom ([More info on QGIS page](https://docs.qgis.org/3.22/en/docs/user_manual/managing_data_source/opening_data.html#geometry-definition)).

First we have our``File name`` with the directory. Followed by the ``Layer name``, in this case ``Places_Visigothic_Councils_minting``. And the ``Encoding`` of our file. Note that this is an important field to check. Often this is set on ``UTF-8`` or ``Latin-9``. At the bottom of the screen we see our **``Sample data``**. Before importing the data it is good to keep an eye on the changes here. If we find unexpected or strange signs in our attribute values, then we need to change the ``Encoding``.

However, we find that in the example screen above something weird is going on. There are no columns, but one long line of Text (String). You might notice there are quite some `;` between the different elements. No worries we can change this in the **``File Format``**.

Here we select the way our data is constrcuted. When we open the csv in Excel we can see the delimiter. In our case it is a semi-colon ``;``, so we have to select **``Custom delimiters``** and check the box _Semicolon_. 

**``! Note``** <br>
When working with a Delimited text it is important to decide on the delimiter and NEVER use this delimiter in your attribute values. This way we avoid problems with uploading our data. In the case you are working with data obtained from others (without a good practice of delimiters) we can select multiple delimiters in the "Custom delimiters".

When we have changed the **``Delimiter``** to the correct setting we will see that the **``Sample Data``** looks like a table. We can also see that QGIS automatically recognizes our data:
* Integer (32 bit)
* Decimal (double)
* Text (String)

If you notice a mistake here, for example your coordinates are Text (string) then it is good to return to your CSV and check for `°` or possible spaces. 

The **``Record and Field Options``** allows us to discard rows under ``Number of header lines to discard``. And indicate the Header of the colums with the ``First record has field names``.

**``Geometry Definition``** handles our spatial information. Here we can select the way our coordinates have to be read. Remember the different systems (DMS, DD and UTM). 
Then we select our ``Geometry CRS`` using the ![image](https://user-images.githubusercontent.com/66669249/175505355-8a54a79b-64ae-45dd-ba94-ffe4dcdc73da.png). We can alwas change the CRS later in our ``Layers panel``. For our data we use the ``CRS`` **EPSG: 4326 - WGS 84**. This is the coordinate system that forms the basis of the DD. 
 
Click **``Add``**, you can check the data in the project and if it is good, then click **``Close``**. 

Now we have added the CSV to our project. We can manipulate the symbology in the same manner as the shapefiles we have been doing before. The downside of the Delimited text layer is that we cannot edit it within QGIS. You will notice that the ![image](https://user-images.githubusercontent.com/66669249/175506009-b40aa1ef-3cbe-4801-967d-ef3150aa019c.png) ``Edit`` icon is grey. If we want to edit the attribute values we need to do this in the CSV and then save the CSV file. After hitting the ![image](https://user-images.githubusercontent.com/66669249/175506680-3bc64ce5-2c65-44f3-bdcd-22755cb9ea0d.png) ``Refresh`` button we will see the changes in QGIS.

**``! Note``**<br>
If you work with a CSV in QGIS and need to change anything else than attribute values (e.g. the name of the file, directory of the file, the names of columns or the number of columns), you will need to add the layer again.

#### 2.1.3 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Delimited text to Shapefile
If we want to work with the data as Vector data in shapefile format we can save it as a ESRI Shapefile. Richt click the layer in the layer panel. Then **``Export ‣ Save Features As...``** and the "Save Vector Layer As..." panel opens. 
It should have ESRI Shapefile as default format. Choose the directory under File Name via ``...``, select the preferred folder.
Leave all other field to default. make sure the box "Add saved file to map" is checked and hit ``OK``. 

For more info on editing Vector data see [Module 6](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/Training_Manual/6.%20Module:%20Creating%20Vector%20Data.md#6-module-creating-vector-data).


## 2.2 Digitalização de dados
We can encounter data in different forms. You have now seen how to work in Excel to create a CSV that can be changed into a shapefile. This is very useful for published Tabular data, or maybe collecting data from different sources. 

### 2.2.1 Georeferencing images
In some cases we want to obtain data from existing maps. For this we can use the georeference tool, **``Layer ‣ Georeferencer...``**. This tool allows us to georeference raster and vector data.  
We will work with a raster file. In the data package for this session you find the map with the "Germanic Kingdoms": _**Die Germanische Nachfolgestaate Westroms (NPAtlas)**_. Since we are interested in this period we might want to digitize the boundaries of the Suebic and Visigothic kingdoms. This map is part of the [Der Neue Pauly Supplemente I Online - Band 3: Historischer Atlas der antiken Welt](https://referenceworks.brillonline.com/browse/der-neue-pauly-supplemente-i-3). As scholars of the Visigothic period we might not fully agree with the extends of the boundaries, but that is for later worry. Let us first start with the digitization of the map as it is.

However, before we start we need to ask ourselves a few questions: 
* _Why am I digitizing the image?_ As stated before, don't create spatial data just because you can. Do you really need it?
* _Is there a way to obtain the data directly from the original source?_ This is an important question. Although it is often easier to just digitize the data directly from a georeferenced image, it is seldomly the best solution. <br>
1. Georeferencing an image distorts the image as it will be warped to fit the projection you are using. If you are lucky the image is on the same projection you are using AND it has not been reshaped by editors. The latter is the worst, often editors of publications just so slightly change the width or heigth of an image to make it fit the page better. Thereby the geospatial relations are completely off. <br>
2. More importantly, eventhough it is a map the information might not be georeferenced at all. When you start georeferencing maps, you will notice that often very good looking maps are not created with a GIS. Places are placed on a map using a graphics programme, like Photoshop or Inkscape. Obviously, georeferencing these maps and then taking the information directly from these maps is not useful. However, they can be a help.<br>
3. Scale. as you will see in a minute, the boundaries are actually quite braod and cover a large area. Zooming in on Toledo you might notice a massive region is covered by the dot representing Toledo. Imagine you want to find a Late Antique villa. It is not very helpful to create data directly from this map. However, it can help narrowing down the area where to look for specific sites.  

#### 2.2.1.1 ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Georeferencing a map
To georeference our map we need points that are found in both the map and in our project. Make sure you have a few layers on for reference:
* the base layer _colorrelief1_
* the Sees layer
* add the rivers from the data package from this course.

To georeference the map:
* Open the georeference tool, **``Layer ‣ Georeferencer...``**.
* Add the map image file, _**Die Germanische Nachfolgestaate Westroms (NPAtlas)**_, as the image to georeference, **``File ‣ Open raster``**.

Next you should define the transformation settings for georeferencing the map:
* Open **``Settings ‣ Transformation settings``**.
* Set the Transformation type to Helmert (for more info on [Transformation types](https://docs.qgis.org/3.28/en/docs/user_manual/working_with_raster/georeferencer.html#available-transformation-algorithms)).
* Set the rest of parameters as shown below.

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/3c470d2a-2152-45ad-ac98-59e91c5c2c1a)

* Click **``OK``**.

**``! Nota``**
Some maps have added coordinates this makes georeferencing a lot easier. In the example we use, the longitude and latidtude are displayed on the sides of the map, from there we were able to position the crosshairs. 

* Select the ![Add Point](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/GRaddPoint.png)**`Add point`** tool and click at a feature in the map that will be easily recognisable.
  A pop-up will appear promting you to enter coordinates. We don't have the coordinates, so we will select the same feature within the map canvas.
* Click the button at the bottom: **`From Map Canvas`**
  The pop-up will disappear and you will be able to navigate the map. Drag and hold using the mouse wheel.
* Right click the feature on the Map Canvas
  You will automatically return to the pop-up and notice coordinates have been entered.
* Click **``OK``**.

Repeat adding reference points several times. The minimum is three, but often eight is the optimum. make sure these are spread out on the map.  

You should end up with something similar to this:

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/33d15113-cbfa-4ac2-8059-dfa1761e99a3)

**``! Nota``**
I have focussed on our region as I want the best result here. There will be more distortion in other regions, compare Italy.
 
Finally, georeference you map:
* **``File ‣ Start georeferencing``**.
Now you can see the map in QGIS project as a georeferenced raster. Note that the raster seems to be slightly rotated, this is the distortion to make the map fit our CRS.
To check that your data is properly georeferenced you can change the transparency of the layer and see if it roughly follows the base map. If this is not the case you could try another transformation, for instance Polynomal. But remember, this distorts the map more and makes the data you will draw from it less reliable. 

Now you have succesfully added the image to your QGIS project! But it is still not the data in the way you want it.

Have you remembered to save your project? Don't want to loose our work now.

### 2.2.2 Drawing vector from raster
It is time to create your vector data from this map. Remember we have three types of data:
1. Point data
2. Line data
3. Polygon data
It is clear that our boundaries are not going to be point data. Nonetheless, we have to decide whether we want to add the boundaries as plygon data, the way they are being presented in the image, or as line data. Both have (dis)advantages.

We will create polygon data as we want to color the area controlled by the kingdoms (remember polygon data has an area, line data doesn't). 

#### 2.2.2.1  ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Creating a Vector file
We will create the vector file for our kingdoms. For this we need another layer in our Data packages: _**Open_Water_IP**_ this is a polygonal vector file that represents the sees around the Iberian Peninsula. Very useful if we want less detail that the bathymetry, but still want blue color. Also note the Lacus Ligustinus and the Ebro delta.

1. Add _**Open_Water_IP**_ as you are used to do with Vector files.
2. Navigate to and click on the menu entry **``Layer ‣ Create Layer ‣ New Shapefile Layer``**. You’ll be presented with the **``New Shapefile Layer``** dialog, which will allow you to define a new layer.

3. Click **``…``** for the **``File name``** field. A save dialog will appear.
4. Navigate to your folder with the data of the project.
5. Save your new layer as _**Kingdoms.shp**_.
6. For **``Geometry Type``**, select **``Polygon``** from the drop down menu. <br>
This has no impact on the rest of the dialog, but it will cause the correct type of geometry to be used when the vector dataset is created.

The next field allows you to specify the Coordinate Reference System, or CRS. CRS is a method of associating numerical coordinates with a position on the surface of the Earth. See the User Manual on [Working with Projections](https://docs.qgis.org/testing/en/docs/user_manual/working_with_projections/working_with_projections.html#label-projections) to learn more.

7. Choose the default CRS associated with this project, which is EPSG:25830 ETRS89 / UTM zone 30N.

Next there is a collection of fields grouped under **``New Field``**. By default, a new layer has only one attribute, the **`id`** field (which you should see in the **``Fields list``**) below. However, in order for the data you create to be useful, you actually need to say something about the features you’ll be creating in this new layer. For our current purposes, it will be enough to add a field called _`Name`_ that will hold **`Text data`** and will be limited to text length of _`80`_ characters .

7. Replicate the setup, then click the **``Add to Fields List``** button.
8. Check that your dialog now looks like this:

![image](https://github.com/Toletum-Network/QGIS_Classical_Studies/assets/66669249/c58ae33d-2a45-4f71-ab75-0e69750b53c5)

9. Click **``OK``**

The new layer should appear in your **``Layers``** panel.

#### 2.2.2.1  ![Basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Creating a Polygon




Certainties


[Passar para a aula seguinte](https://github.com/Toletum-Network/QGIS_Classical_Studies/blob/master/M%C3%A9todos_espaciais_para_os_visigodos/3.%20An%C3%A1lises_de_datos_PT.md#an%C3%A1lises-de-datos-relacional-e-quantitativa)

